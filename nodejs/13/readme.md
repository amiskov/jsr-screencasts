# События, EventEmitter и утечки памяти
`EventEmitter` — основной объект для работы с событиями в Ноде. В чистом виде почти не используется, в основном работаем с его наследниками: серверами, запросами и т. д.

Emit по-английски — выпускать, выбрасывать.

На событие можно подписаться (метод `on`) и передать обработчик. Подписчики будут вызваны в порядке объявления.

Метод `emit` генерирует событие и передает данные.

## Отличия от работы с событиями в браузере
* Нодовские обработчики срабатывают именно в том порядке, в котором были назначены.
* В браузере нельзя получить список обработчиков, назначенных на элемент. А в Ноде можно: [`emitter.listeners(event)`](https://nodejs.org/dist/latest-v7.x/docs/api/events.html#events_emitter_listeners_eventname).
* В Нодовских событиях особым образом обрабатывается событие с названием `error`. Если где-то есть такое событие и без обработчика, то эмиттер сгенерирует исключение и повалит весь процесс.

## Борьба с утечками памяти
Обработчики события запоминаются в оъекте и когда происходит событие, то они оттуда вызываются.

У `EventEmitter` есть максимальное число обработчиков (равно 10 в `7.9`). Как только оно превышается, то выводится ворнинг:

```sh
MaxListenersExceededWarning: Possible EventEmitter memory leak detected. 11 data listeners added. Use emitter.setMaxListeners() to increase limit
```

Чтобы утечки не происходило, то после работы обработчика можно убрать его.

Иногда убирают лимит для слушателей: `db.setMaxListeners(0)`. Это может вести к неконтролируемым утечкам.

Помочь может модуль [`heapdump`](https://www.npmjs.com/package/heapdump).

