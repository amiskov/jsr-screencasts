# Writable поток ответа res, метод pipe
Использование потоков для работы с сетевыми соединениями.

Можно, конечно, использовать `fs.readFile` для отдачи файлов по запросу, но это плохо:

* Когда файл большой, он будет сначала целиком загружаться в память
* Если имеется ряд медленных клиентов, то файл будет висеть в памяти довольно долго
* Когда много посетителей, то такой вариант приведет к быстрому захламлению памяти

## Отдача файла через входной и выходной потоки
Входным потоком будет `fs.ReadStream`, а выходным – аргумент `res`, который так же является потоком.

У `readable`-потоков есть метод `.pipe()`: `file.pipe(res)`. Таких методов у входного потока может быть несолько. Например, можно отдавать клиенту и выводить в `process.stdout`.

```bash
curl --limit-rate 1k http://localhost:3000/big.html
```

Если клиент завершил соединение, а передача еще не завершена, то файл не закрывается (файл должен быть довольно большим).

Для потока `res` есть событие `.on('close')`. И это не такой `close`, как в файлах, это значит, что соединение было оборвано. При нормальном завершении срабатывает событие `finish`. Через `close` мы можем руками отловить разорванное соединение и закрыто входящий поток:

```js
res.on('close', () => { // если соединение оборвано
    file.destroy(); // ...вырубаем входящий поток из файла
});
```

